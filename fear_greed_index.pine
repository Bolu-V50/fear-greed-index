//@version=5
indicator("恐惧贪婪指数 (每日更新)", overlay=false)

// 更新时间: 2025-12-29 02:25

var float[] values = array.new_float()
var int[] dates = array.new_int()

if barstate.isfirst
    array.push(dates, timestamp(2025, 12, 29))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 12, 28))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 12, 27))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 12, 26))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 12, 25))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 12, 24))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 12, 23))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 12, 22))
    array.push(values, 25)
    array.push(dates, timestamp(2025, 12, 21))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 12, 20))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 12, 19))
    array.push(values, 16)
    array.push(dates, timestamp(2025, 12, 18))
    array.push(values, 17)
    array.push(dates, timestamp(2025, 12, 17))
    array.push(values, 16)
    array.push(dates, timestamp(2025, 12, 16))
    array.push(values, 11)
    array.push(dates, timestamp(2025, 12, 15))
    array.push(values, 16)
    array.push(dates, timestamp(2025, 12, 14))
    array.push(values, 21)
    array.push(dates, timestamp(2025, 12, 13))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 12, 12))
    array.push(values, 29)
    array.push(dates, timestamp(2025, 12, 11))
    array.push(values, 29)
    array.push(dates, timestamp(2025, 12, 10))
    array.push(values, 26)
    array.push(dates, timestamp(2025, 12, 9))
    array.push(values, 22)
    array.push(dates, timestamp(2025, 12, 8))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 12, 7))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 12, 6))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 12, 5))
    array.push(values, 28)
    array.push(dates, timestamp(2025, 12, 4))
    array.push(values, 26)
    array.push(dates, timestamp(2025, 12, 3))
    array.push(values, 28)
    array.push(dates, timestamp(2025, 12, 2))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 12, 1))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 11, 30))
    array.push(values, 28)
    array.push(dates, timestamp(2025, 11, 29))
    array.push(values, 28)
    array.push(dates, timestamp(2025, 11, 28))
    array.push(values, 25)
    array.push(dates, timestamp(2025, 11, 27))
    array.push(values, 22)
    array.push(dates, timestamp(2025, 11, 26))
    array.push(values, 15)
    array.push(dates, timestamp(2025, 11, 25))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 11, 24))
    array.push(values, 19)
    array.push(dates, timestamp(2025, 11, 23))
    array.push(values, 13)
    array.push(dates, timestamp(2025, 11, 22))
    array.push(values, 11)
    array.push(dates, timestamp(2025, 11, 21))
    array.push(values, 14)
    array.push(dates, timestamp(2025, 11, 20))
    array.push(values, 11)
    array.push(dates, timestamp(2025, 11, 19))
    array.push(values, 15)
    array.push(dates, timestamp(2025, 11, 18))
    array.push(values, 11)
    array.push(dates, timestamp(2025, 11, 17))
    array.push(values, 14)
    array.push(dates, timestamp(2025, 11, 16))
    array.push(values, 10)
    array.push(dates, timestamp(2025, 11, 15))
    array.push(values, 10)
    array.push(dates, timestamp(2025, 11, 14))
    array.push(values, 16)
    array.push(dates, timestamp(2025, 11, 13))
    array.push(values, 15)
    array.push(dates, timestamp(2025, 11, 12))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 11, 11))
    array.push(values, 26)
    array.push(dates, timestamp(2025, 11, 10))
    array.push(values, 29)
    array.push(dates, timestamp(2025, 11, 9))
    array.push(values, 22)
    array.push(dates, timestamp(2025, 11, 8))
    array.push(values, 20)
    array.push(dates, timestamp(2025, 11, 7))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 11, 6))
    array.push(values, 27)
    array.push(dates, timestamp(2025, 11, 5))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 11, 4))
    array.push(values, 21)
    array.push(dates, timestamp(2025, 11, 3))
    array.push(values, 42)
    array.push(dates, timestamp(2025, 11, 2))
    array.push(values, 37)
    array.push(dates, timestamp(2025, 11, 1))
    array.push(values, 33)
    array.push(dates, timestamp(2025, 10, 31))
    array.push(values, 29)
    array.push(dates, timestamp(2025, 10, 30))
    array.push(values, 34)
    array.push(dates, timestamp(2025, 10, 29))
    array.push(values, 51)
    array.push(dates, timestamp(2025, 10, 28))
    array.push(values, 50)
    array.push(dates, timestamp(2025, 10, 27))
    array.push(values, 51)
    array.push(dates, timestamp(2025, 10, 26))
    array.push(values, 40)
    array.push(dates, timestamp(2025, 10, 25))
    array.push(values, 37)
    array.push(dates, timestamp(2025, 10, 24))
    array.push(values, 30)
    array.push(dates, timestamp(2025, 10, 23))
    array.push(values, 27)
    array.push(dates, timestamp(2025, 10, 22))
    array.push(values, 25)
    array.push(dates, timestamp(2025, 10, 21))
    array.push(values, 34)
    array.push(dates, timestamp(2025, 10, 20))
    array.push(values, 29)
    array.push(dates, timestamp(2025, 10, 19))
    array.push(values, 29)
    array.push(dates, timestamp(2025, 10, 18))
    array.push(values, 23)
    array.push(dates, timestamp(2025, 10, 17))
    array.push(values, 22)
    array.push(dates, timestamp(2025, 10, 16))
    array.push(values, 28)
    array.push(dates, timestamp(2025, 10, 15))
    array.push(values, 34)
    array.push(dates, timestamp(2025, 10, 14))
    array.push(values, 38)
    array.push(dates, timestamp(2025, 10, 13))
    array.push(values, 38)
    array.push(dates, timestamp(2025, 10, 12))
    array.push(values, 24)
    array.push(dates, timestamp(2025, 10, 11))
    array.push(values, 27)
    array.push(dates, timestamp(2025, 10, 10))
    array.push(values, 64)
    array.push(dates, timestamp(2025, 10, 9))
    array.push(values, 70)
    array.push(dates, timestamp(2025, 10, 8))
    array.push(values, 60)
    array.push(dates, timestamp(2025, 10, 7))
    array.push(values, 70)
    array.push(dates, timestamp(2025, 10, 6))
    array.push(values, 71)
    array.push(dates, timestamp(2025, 10, 5))
    array.push(values, 74)
    array.push(dates, timestamp(2025, 10, 4))
    array.push(values, 71)
    array.push(dates, timestamp(2025, 10, 3))
    array.push(values, 63)
    array.push(dates, timestamp(2025, 10, 2))
    array.push(values, 64)
    array.push(dates, timestamp(2025, 10, 1))
    array.push(values, 49)

getValue() =>
    result = 50.0
    currentDate = timestamp(year, month, dayofmonth)
    for i = 0 to array.size(dates) - 1
        if array.get(dates, i) == currentDate
            result := array.get(values, i)
            break
    result

fgi = getValue()
ma7 = ta.sma(fgi, 7)
ma30 = ta.sma(fgi, 30)

getColor(v) =>
    v <= 25 ? color.red : v <= 45 ? color.orange : v <= 55 ? color.yellow : v <= 75 ? color.green : color.rgb(0,200,0)

plot(fgi, "Fear & Greed", color=getColor(fgi), linewidth=3)
plot(ma7, "MA7", color=color.blue, linewidth=1)
plot(ma30, "MA30", color=color.purple, linewidth=1)

bgcolor(fgi <= 25 ? color.new(color.red, 95) : na)
bgcolor(fgi > 25 and fgi <= 45 ? color.new(color.orange, 95) : na)
bgcolor(fgi > 45 and fgi <= 55 ? color.new(color.yellow, 95) : na)
bgcolor(fgi > 55 and fgi <= 75 ? color.new(color.green, 95) : na)
bgcolor(fgi > 75 ? color.new(color.green, 90) : na)

hline(25, "极度恐惧", color=color.red, linestyle=hline.style_dotted)
hline(45, "恐惧", color=color.orange, linestyle=hline.style_dotted)
hline(55, "中性", color=color.gray, linestyle=hline.style_dotted)
hline(75, "贪婪", color=color.green, linestyle=hline.style_dotted)
hline(0, "Min", color=color.gray)
hline(100, "Max", color=color.gray)

var table infoTable = table.new(position.top_right, 2, 4)
if barstate.islast
    table.cell(infoTable, 0, 0, "当前指数", bgcolor=color.navy, text_color=color.white)
    table.cell(infoTable, 1, 0, str.tostring(fgi, "#"), bgcolor=getColor(fgi), text_color=color.white)
    table.cell(infoTable, 0, 1, "7日均线", text_color=color.blue)
    table.cell(infoTable, 1, 1, str.tostring(ma7, "#"), text_color=color.blue)
    table.cell(infoTable, 0, 2, "30日均线", text_color=color.purple)
    table.cell(infoTable, 1, 2, str.tostring(ma30, "#"), text_color=color.purple)
    table.cell(infoTable, 0, 3, "更新日期", text_color=color.gray)
    table.cell(infoTable, 1, 3, "2025-12-29", text_color=color.gray)
